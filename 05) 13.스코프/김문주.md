# 13. 스코프

- 함수의 매개변수는 함수 몸체 내부에서만 참조할 수 있다.
- 함수 몸체 외부에서는 참조할 수 없다.
  - 매개변수를 참조할 수 있는 유효범위, 즉 매개변수의 스코프가 함수 몸체 내부로 한정되기 때문이다.
    ```jsx
    function add(x, y) {
      // 매개변수는 함수 몸체 내부에서만 참조할 수 있다.
      // 즉, 매개변수의 스코프(유효범위)는 함수 몸체 내부다.
      console.log(x, y); //2, 5
      return x + y;
    }

    add(2, 5);

    // 매개변수는 함수 몸체 내부에서만 참조할 수 있다.
    console.log(x, y); // ReferenceError: x is not defined
    ```
- 변수는 코드이 가장 바깥 영역뿐만 아니라 코드 블록이나 함수 몸체 내에서도 선언할 수 있다.
- 모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다. **즉, 스코프는 식별자가 유효한 범위를 말한다.**

```jsx
var x = "global";

function foo() {
  var x = "local";
  console.log(x); // local
}

foo();

console.log(x); //global
```

**코드의 문맥과 환경**

> 코드가 어디서 실행되며 주변에 어떤 코드가 있는지를 렉시컬 환경이라 한다.

- 바깥 영역에 선언된 x 변수는 어디서든 참조할 수 있지만, foo 함수 내부에서 선언된 x 변수를 foo 함수 내부에서만 참조할 수 있고 foo 함수 외부에서는 참조할 수 없다.
- **다시 말해 이름이 동일한 식별자이지만 스코프가 다른 별개의 변수이다.**

**var 키워드로 선언한 변수의 중복 선언**

```jsx
function foo() {
  var x = 1;
  // var 키워드로 선언된 변수는 같은 스코프 내에서 선언을 허용한다.
  // 아래 변수 선언문은 자바스크립트 엔진에 의해 var 키워드가 없는 것처럼 동작한다.
  var x = 2;
  console.log(x); // 2
}
foo();
```

**하지만** let, const 키워드로 선언된 변수는 같은 스코프 내에서 중복 선언을 허용하지 않는다.

## 스코프의 종류

| 구분 | 설명                  | 스코프      | 변수      |
| ---- | --------------------- | ----------- | --------- |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 | 함수 몸체 내부        | 지역 스코프 | 지역 변수 |

- 변수는 자신이 선언된 위치(전역 또는 지역)에 의해 자신이 유효한 범위인 스코프가 결정된다.

## 스코프 체인

- 함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있다.
  - 스코프가 함수의 중첩에 의해 계층적 구조를 갖는다.
- 모든 스코프는 **하나의 계층적 구조**로 연결되며, 모든 지역 스코프의 **최상위 스코프는 전역 스코프다**. 계층적 구조를 **스코프 체인**이라 한다.
- 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코도의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색 한다.

**렉시컬 환경**

> 스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것이다. 전역 렉시컬 환경은 코드로 로드되면 곧바로 생성되고 함수의 렉시컬 환경은 함수가 호출되면 곧바로 생성된다.

## 함수 레벨 스코프

> 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다.

블록 레벨 스코프 : 대부분의 프로그래밍 언어는 함수 몸체만이 아닌 모든 코드 블록이 지역 스코프를 만든다.

함수 레벨 스코프 : var 키워드로 선언된 변수는 오로지 함수의 코드 블록만을 지역 스코프로 인정한다.

## 렉시컬 스코프

```jsx
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // 1
bar(); // 1
```

- 자바스크립트는 렉시컬 스코프를 따르므로 함수를 어디서 홀출했는지가 아니라 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다. 즉, 함수의 상위 스코프는 언제나 자신이 정의된 스코프다.
- 함수의 상위 스코프를 함수 정의가 실행될 때 정적으로 결정된다.
